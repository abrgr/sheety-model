{"version":3,"sources":["../../src/lib/cell-format.js"],"names":["types","Object","freeze","TEXT","NUMBER","PERCENT","CURRENCY","DATE","TIME","DATE_TIME","SCIENTIFIC","isNumericType","type","probablyToNum","val","exec","toStr","toJSValue","format","toFormatableValue","userEnteredValueToSheetValue","match","NaN","parseFloat","diff","CellFormatRecord","pattern","coercer","bind","CellFormat","params","valueOf","get","value","matchingTypes","userEnteredValue","Types"],"mappings":";;;;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;AAEA,IAAMA,QAAQC,OAAOC,MAAP,CAAc;AAC1BC,QAAM,MADoB;AAE1BC,UAAQ,QAFkB;AAG1BC,WAAS,SAHiB;AAI1BC,YAAU,UAJgB;AAK1BC,QAAM,MALoB;AAM1BC,QAAM,MANoB;AAO1BC,aAAW,WAPe;AAQ1BC,cAAY;AARc,CAAd,CAAd;;AAWA,SAASC,aAAT,CAAuBC,IAAvB,EAA6B;AAC3B,SAAOA,SAASZ,MAAMG,IAAtB;AACD;;AAED,IAAMU,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAS;AAC7B,MAAK,OAAOA,GAAP,KAAe,QAApB,EAA+B;AAC7B,WAAOA,GAAP;AACD;;AAED,MAAK,oBAAoBC,IAApB,CAAyB,KAAKD,GAA9B,CAAL,EAA0C;AACxC,WAAO,CAACA,GAAR;AACD;;AAED;AACA,SAAOA,GAAP;AACD,CAXD;AAYA,IAAME,QAAQ,SAARA,KAAQ,CAACF,GAAD;AAAA,SAAS,CAAC,CAACA,GAAF,GAAS,KAAKA,GAAd,GAAqB,EAA9B;AAAA,CAAd;;AAEA,IAAMG,aAAYhB,OAAOC,MAAP,CAAc;AAC9BC,QAAMa,KADwB;AAE9BZ,UAAQS,aAFsB;AAG9BR,WAASQ,aAHqB;AAI9BP,YAAUO,aAJoB;AAK9BN,QAAM,cAACO,GAAD;AAAA,WAAS,sBAAO,cAAII,MAAJ,CAAW,YAAX,EAAyBJ,GAAzB,CAAP,EAAsC,YAAtC,CAAT;AAAA,GALwB;AAM9BN,QAAM,cAACM,GAAD;AAAA,WAAS,sBAAO,cAAII,MAAJ,CAAW,qBAAX,EAAkCJ,GAAlC,CAAP,EAA+C,qBAA/C,CAAT;AAAA,GANwB,EAMwD;AACtFL,aAAW,mBAACK,GAAD;AAAA,WAAS,sBAAO,cAAII,MAAJ,CAAW,qBAAX,EAAkCJ,GAAlC,CAAP,EAA+C,qBAA/C,CAAT;AAAA,GAPmB;AAQ9BJ,cAAYG;AARkB,CAAd,CAAlB;;AAWA,IAAMM,oBAAoBlB,OAAOC,MAAP,CAAc;AACtCC,QAAMa,KADgC;AAEtCZ,UAAQS,aAF8B;AAGtCR,WAASQ,aAH6B;AAItCP,YAAUO,aAJ4B;AAKtCN,QAAMM,aALgC;AAMtCL,QAAMK,aANgC;AAOtCJ,aAAWI,aAP2B;AAQtCH,cAAYG;AAR0B,CAAd,CAA1B;;AAWA,IAAMO,+BAA+BnB,OAAOC,MAAP,CAAc;AACjDC,QAAM,cAACW,GAAD;AAAA,WAAS,KAAKA,GAAd;AAAA,GAD2C;AAEjDV,UAAQ,gBAACU,GAAD;AAAA,WAAS,CAACA,GAAV;AAAA,GAFyC;AAGjDT,WAAS,iBAACS,GAAD;AAAA,WAAU,CAACA,GAAF,GAAS,GAAlB;AAAA,GAHwC;AAIjDR,YAAU,kBAACQ,GAAD,EAAS;AACjB,QAAMO,QAAQ,mBAAmBN,IAAnB,CAAwB,KAAKD,GAA7B,CAAd;AACA,QAAK,CAACO,KAAN,EAAc;AACZ,aAAOC,GAAP;AACD;AACD,WAAOC,WAAWF,MAAM,CAAN,CAAX,CAAP;AACD,GAVgD;AAWjDd,QAAM,cAACO,GAAD;AAAA,WAAS,sBAAOA,GAAP,EAAYU,IAAZ,CAAiB,sBAAO,YAAP,CAAjB,EAAuC,MAAvC,CAAT;AAAA,GAX2C;AAYjDhB,QAAM,cAACM,GAAD;AAAA,WAAS,sBAAOA,GAAP,CAAT;AAAA,GAZ2C,EAYrB;AAC5BL,aAAW,mBAACK,GAAD;AAAA,WAAS,sBAAOA,GAAP,EAAYU,IAAZ,CAAiB,sBAAO,YAAP,CAAjB,IAAyC,QAAlD;AAAA,GAbsC;AAcjDd,cAAY,oBAACI,GAAD;AAAA,WAAS,CAACA,GAAV;AAAA;AAdqC,CAAd,CAArC;;AAiBA,IAAMW,mBAAmB,uBAAO;AAC9Bb,QAAMZ,MAAMG,IADkB;AAE9BuB,WAAS;AAFqB,CAAP,CAAzB;;AAKA,IAAMC,UAAU,iBAAOC,IAAP,CAAY,IAAZ,EAAkB,mBAAQ;AACxChB,QAAM,cAACA,KAAD;AAAA,WAAU,CAAC,CAACA,KAAF,IAAU,CAAC,CAACZ,MAAMY,KAAN,CAAZ,GAA0BA,KAA1B,GAAiCZ,MAAMG,IAAjD;AAAA,GADkC;AAExCuB,WAAS,iBAACA,QAAD;AAAA,WAAa,CAAC,CAACA,QAAF,GAAYA,QAAZ,GAAsB,EAAnC;AAAA;AAF+B,CAAR,CAAlB,CAAhB;;IAKqBG,U;;;AACnB,sBAAYC,MAAZ,EAAoB;AAAA;;AAAA,mHACZH,QAAQG,MAAR,CADY;AAEnB;;;;2BAEMhB,G,EAAK;AACV,UAAMiB,UAAUZ,kBAAkB,KAAKa,GAAL,CAAS,MAAT,CAAlB,CAAhB;AACA,UAAMC,QAAQ,CAAC,CAACF,OAAF,GAAYA,QAAQjB,GAAR,CAAZ,GAA2BA,GAAzC;;AAEA,UAAMoB,gBAAgBvB,cAAc,KAAKqB,GAAL,CAAS,MAAT,CAAd,IACA,OAAOC,KAAP,KAAiB,QADjB,GAEA,OAAOA,KAAP,KAAiB,QAFvC;;AAIA,aAAOC,gBACA,cAAIhB,MAAJ,CAAW,KAAKc,GAAL,CAAS,SAAT,CAAX,EAAgCC,KAAhC,CADA,GAEAnB,GAFP;AAGD;;;8BAESA,G,EAAK;AACb,UAAMiB,UAAUd,WAAU,KAAKe,GAAL,CAAS,MAAT,CAAV,CAAhB;AACA,aAAOD,UAAUA,QAAQjB,GAAR,CAAV,GAAyBA,GAAhC;AACD;;;yCAEoBqB,gB,EAAkB;AACrC,UAAMJ,UAAUX,6BAA6B,KAAKY,GAAL,CAAS,MAAT,CAA7B,CAAhB;AACA,aAAOD,UACAA,QAAQI,gBAAR,CADA,GAEAA,gBAFP;AAGD;;;;EA5BqCV,gB;;kBAAnBI,U;;;AA+BrBA,WAAWO,KAAX,GAAmBpC,KAAnB","file":"cell-format.js","sourcesContent":["import { Map, Record } from 'immutable';\nimport ssf from 'ssf';\nimport moment from 'moment';\nimport coerce from './coerce';\n\nconst types = Object.freeze({\n  TEXT: 'TEXT',\n  NUMBER: 'NUMBER',\n  PERCENT: 'PERCENT',\n  CURRENCY: 'CURRENCY',\n  DATE: 'DATE',\n  TIME: 'TIME',\n  DATE_TIME: 'DATE_TIME',\n  SCIENTIFIC: 'SCIENTIFIC'\n});\n\nfunction isNumericType(type) {\n  return type !== types.TEXT;\n}\n\nconst probablyToNum = (val) => {\n  if ( typeof val === 'number' ) {\n    return val;\n  }\n\n  if ( /^(-+)?\\d*[.]?\\d*$/.exec('' + val) ) {\n    return +val;\n  }\n\n  // probably mis-categorized as a number\n  return val;\n};\nconst toStr = (val) => !!val ? ('' + val) : '';\n\nconst toJSValue = Object.freeze({\n  TEXT: toStr,\n  NUMBER: probablyToNum,\n  PERCENT: probablyToNum,\n  CURRENCY: probablyToNum,\n  DATE: (val) => moment(ssf.format('yyyy-mm-dd', val), 'YYYY-MM-DD'),\n  TIME: (val) => moment(ssf.format('yyyy-mm-dd hh:mm:ss', val), 'YYYY-MM-DD HH:mm:ss'), // TODO: is this right?\n  DATE_TIME: (val) => moment(ssf.format('yyyy-mm-dd hh:mm:ss', val), 'YYYY-MM-DD HH:mm:ss'),\n  SCIENTIFIC: probablyToNum\n});\n\nconst toFormatableValue = Object.freeze({\n  TEXT: toStr,\n  NUMBER: probablyToNum,\n  PERCENT: probablyToNum,\n  CURRENCY: probablyToNum,\n  DATE: probablyToNum,\n  TIME: probablyToNum,\n  DATE_TIME: probablyToNum,\n  SCIENTIFIC: probablyToNum\n});\n\nconst userEnteredValueToSheetValue = Object.freeze({\n  TEXT: (val) => '' + val,\n  NUMBER: (val) => +val,\n  PERCENT: (val) => (+val) / 100,\n  CURRENCY: (val) => {\n    const match = /[0-9]*[.,][0-9]*/.exec('' + val);\n    if ( !match ) {\n      return NaN;\n    }\n    return parseFloat(match[0]);\n  },\n  DATE: (val) => moment(val).diff(moment('1899-12-30'), 'days'),\n  TIME: (val) => moment(val), // TODO: is this right?\n  DATE_TIME: (val) => moment(val).diff(moment('1899-12-30')) / 86400000,\n  SCIENTIFIC: (val) => +val\n});\n\nconst CellFormatRecord = Record({\n  type: types.TEXT,\n  pattern: ''\n});\n\nconst coercer = coerce.bind(null, new Map({\n  type: (type) => !!type && !!types[type] ? type : types.TEXT,\n  pattern: (pattern) => !!pattern ? pattern : ''\n}));\n\nexport default class CellFormat extends CellFormatRecord {\n  constructor(params) {\n    super(coercer(params));\n  }\n\n  format(val) {\n    const valueOf = toFormatableValue[this.get('type')];\n    const value = !!valueOf ? valueOf(val) : val;\n\n    const matchingTypes = isNumericType(this.get('type'))\n                        ? typeof value === 'number'\n                        : typeof value === 'string';\n\n    return matchingTypes\n         ? ssf.format(this.get('pattern'), value)\n         : val;\n  }\n\n  toJSValue(val) {\n    const valueOf = toJSValue[this.get('type')];\n    return valueOf ? valueOf(val) : val;\n  }\n\n  fromUserEnteredValue(userEnteredValue) {\n    const valueOf = userEnteredValueToSheetValue[this.get('type')];\n    return valueOf\n         ? valueOf(userEnteredValue)\n         : userEnteredValue;\n  }\n}\n\nCellFormat.Types = types;\n"]}